<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
    <script src="js/setup.js"></script>
    <script src="js/loadLinks.js" defer></script>
    <script src="js/newLink.js" defer></script>
    <script src="js/clock.js" defer></script>
    <script src="js/greeting.js" defer></script>
    <script src="js/backgroundLoader.js" defer></script>
    <script src="js/getFavicon.js" defer></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="setup">
        <div class="setup-wrapper">
            <h1>What is your name?</h1>
            <div class="inputbox">
                <input required="required" type="text" id="user">
                <span>Your Name</span>
                <i></i>
            </div>

            <div class="category-wrapper">
                <div style="margin-left: 4rem;" class="inputbox">
                    <input required="required" type="text" id="category">
                    <span>Select Categories</span>
                    <i></i>
                </div>
                <button class="button material-icons" onclick="addCategory(document.getElementById('category').value)" id="addCategory">add</button>
            </div>
            <div class="selected-Categories" id="selected-Categories">
               
            </div>
            
        <button class="button" onclick="setup()" id="saveSetup">FINISH</button>
        </div>
    </div>

    <div class="wrapper">
        <div id = "clock" onload="currentTime()"></div>
        <h2 id="greeting">Good evening, Vasco</h2>
        <div class="links-wrapper" id="linksArea">
            
            <div class="link-container" id="openNewLinkDialog">
                <span id="addlink" class="material-icons">add</span>
                <span>add</span>
            </div>
        </div>

            <dialog aria-labelledby="dialog_title" id="newLink">
                <form >
                    <p class="inputItems">
                      <label>
                        Website Name:</br>
                        <input type="text" id="newLinkName"/>
                      </label>
                      <label>
                        Link:</br>
                        <input type="text" id="newLinkUrl"/>
                      </label>
                    </p>
                    <div class="newLinkButtons">
                      <button value="cancel" formmethod="dialog">Cancel</button>
                      <button id="confirmBtn" value="default">Confirm</button>
                    </div>
                  </form>
              </dialog>

    </div>

    <script>

       

        function generateId(usedIds){

        }

        categoryArr = ["nature","mountains","city","beach","winter","summer","animals"];
        userCategories = [];
        var savedCategories = JSON.parse(localStorage.getItem("categories"));
        window.onload = () => {
            let setupWin = document.getElementById("setup");
            const username = localStorage.getItem("username");
            if(!username){
                setupWin.style.display = "block";
            }else{
                setupWin.style.display = "none";
                let greetingEl = document.getElementById("greeting")
            greetingEl.innerHTML = `${loadGreeting()}, ${username}`;
            //let randomCat = Math.floor(Math.random() * savedCategories.length);
              //  renderItem(savedCategories[randomCat]);
            
            loadSavedLinks();
            let linksWrapper = document.querySelectorAll(".links-wrapper");
            for(let i = 0; i<=linksWrapper[0].children.length-1; i++){
                let iconImage = getIcon(linksWrapper[0].children[i].children[0].dataset.link, linksWrapper[0].children[i].children[0]);
            }
            }
            function padTo2Digits(num) {
        return num.toString().padStart(2, '0');
        }

        function formatDate(date) {
        return (
            [
            date.getFullYear(),
            padTo2Digits(date.getMonth() + 1),
            padTo2Digits(date.getDate()),
            ].join('-') +
            ' ' +
            [
            padTo2Digits(date.getHours()),
            padTo2Digits(date.getMinutes()),
            padTo2Digits(date.getSeconds()),
            ].join(':')
        );
        }

        // todayDate e tomorrowDate, tem de vir do localStorage, só se nao tiver nada é que seta dados novos
        let todayDataStorage = localStorage.getItem("lastVisit");
        let tomorrowDataStorage = localStorage.getItem("nextImageDate");
        var todayDate = new Date();
        var tomorrowDate =  new Date();
        localStorage.setItem("lastVisit",formatDate(todayDate));
      
            
        tomorrowDate.setDate(tomorrowDate.getDate()+1);
        tomorrowDate.setHours(0,0,0);
        var lastVisit = localStorage.getItem("lastVisit");
       
        
            if(todayDataStorage < tomorrowDataStorage){
            //today lower than tomorrow
            renderItem(null,false);
        }else{
            //today after tomorrow
            let randomCat = Math.floor(Math.random() * savedCategories.length);
            renderItem(savedCategories[randomCat],true);
            localStorage.setItem("nextImageDate", formatDate(tomorrowDate));
        }
    
        } 
    </script>
</body>
</html>